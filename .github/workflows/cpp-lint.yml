name: C++ Linting

on:
  push:
    branches: [ main, sna_project]
  pull_request:
    branches: [ main, sna_project]

jobs:
  clang-tidy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    - name: Install clang-tidy
      run: |
        sudo apt-get update
        sudo apt-get install -y clang-tidy

    - name: Run clang-tidy
      run: |
        # Find all C++ files and run clang-tidy on them
        find src include -type f \( -name '*.cpp' -o -name '*.hpp' -o -name '*.h' \) \
          -exec clang-tidy {} --quiet \
          --warnings-as-errors='*' \
          --config-file="$(pwd)/.clang-tidy" \;

    # Optional: Add compilation step to ensure clang-tidy has compilation database
    - name: Generate compile_commands.json
      run: |
        mkdir -p build
        cd build
        cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON ..
        mv compile_commands.json ..
        
    - name: Run clang-tidy with compilation database
      run: |
        find src include -type f \( -name '*.cpp' -o -name '*.hpp' -o -name '*.h' \) \
          -exec clang-tidy {} --quiet \
          --warnings-as-errors='*' \
          --config-file="$(pwd)/.clang-tidy" \
          -p "$(pwd)" \;
